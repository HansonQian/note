### 短信发送问题

可以理解成CIS系统和短信平台系统交互

#### 示例代码

```java
public Map<String,String> businessProcess(){
    Map<String,String> retMap = new HashMap<>();
	boolean flag =false;
    try{
    	//收费处理
   		flag =  chargeProcess();
        commit;
    }catch(Exception e){
    	rollback;
        //返回缴费失败信息
    }
    if(flag){
    	//短信发送
		messageProcess();
    }
    //返回缴费成功信息
    return retMap;
}
```

第三方系统调用CIS进行缴费，CIS系统内部处理逻辑：先销账，根据销账结果决定是否发送短信。

销账失败，不发送短信，直接给第三方系统返回失败结果

销账成功，发送短信；发送短信分为异步发送和同步发送

- 异步发送：将待发送的信息存储到`c_sms_log`表，通过定时任务或者其他机制发送短信。
  - **优点**：不需要等下短信发送结果，便可进行下一步业务操作。数据存储在表中可以做补偿机制，对于发送超时或者失败的数据可以进行重试。
  - **缺点**：用电用户不能实时收到自己缴费成功信息。

- 同步发送
  - **优点**：用电用户能实时收到自己缴费成功信息
  - **缺点**：当存在网络问题，调用短信平台势必会有请求超时现象。应当设置请求超时时间阀值，当超过请求超时的阀值，立即返回失败，并修改表中记录为发送失败。后续可以通过将失败的记录查询出来，在进行补偿措施。